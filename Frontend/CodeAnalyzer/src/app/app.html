<div>
  <mat-toolbar color="primary" class="navbar">
    <span class="logo">DetectAI</span>
    <span class="spacer"></span>
  </mat-toolbar>

  <div class = "content">
    <div class="inputBlock">
      <h4>Input</h4>
      <div class="codeBlock"> 
        <textarea #codeBox rows="22" cols="80" placeholder="Paste your code"></textarea>
        <button class="codeButton" (click)="analyzeCode(codeBox.value)">Analyze Code</button>
      </div>
      <br>
      <div class="fileUploadBlock">
        <h4 style="margin-top:25px;"> Upload File </h4>
        <input type="file" (change)="onFileSelected($event)" />
        <button style="margin-top: 3rem;" class="fileButton" (click)="uploadFile()">Analyze File</button>
      </div>
    </div>

    <div class="responseBlock">
      <h4>Response</h4>
      <div class="loader" *ngIf="loading">
        <mat-spinner diameter="50"></mat-spinner>
        <p>Analyzing...</p>
      </div>
      @if (responseReceived) {
            <div class="analysis-container">
              <!-- 1️⃣ Errors Section -->
              <h4 (click)="toggleSection('errors')" style="cursor: pointer;">
                ▶ Errors
              </h4>
              @if (expandedSections['errors']) {
                <ul>
                  @for (err of analysisResult.errors; track $index) {
                    <li><strong>Line {{ err.line }}:</strong> {{ err.description }}</li>
                  }
                </ul>
              }

              <!-- 2️⃣ Fixes Section -->
              <h4 (click)="toggleSection('fixes')" style="cursor: pointer;">
                ▶ Suggested Fixes
              </h4>
              @if (expandedSections['fixes']) {
                <ul>
                  @for (fix of analysisResult.fixes; track $index) {
                    <li>{{ fix }}</li>
                  }
                </ul>
              }

              <!-- 3️⃣ Summary Section -->
              <h4 (click)="toggleSection('summary')" style="cursor: pointer;">
                ▶ Summary
              </h4>
              @if (expandedSections['summary']) {
                <p>{{ analysisResult.summary }}</p>
              }

              <!-- 4️⃣ Functionality Section -->
              <h4 (click)="toggleSection('functionality')" style="cursor: pointer;">
                ▶ Functionality
              </h4>
              @if (expandedSections['functionality']) {
                <ul>
                  @for (func of analysisResult.functionality; track $index) {
                    <li>{{ func }}</li>
                  }
                </ul>
              }

              <!-- 5️⃣ Conclusion Section -->
              <h4 (click)="toggleSection('conclusion')" style="cursor: pointer;">
                ▶ Conclusion
              </h4>
              @if (expandedSections['conclusion']) {
                <p>{{ analysisResult.conclusion }}</p>
              }
            </div>
          }
    </div>
  </div>
</div>